# âœ… MCP Client ç­‰å¾…æ©Ÿåˆ¶å·²å¯¦ç¾

## ğŸ“‹ å•é¡Œè§£æ±º

æ‚¨æå‡ºçš„å•é¡Œï¼š**"MCP Client å‘¼å« user feedback mcp server çš„æ™‚å€™ï¼Œæœƒç›´æ¥çµæŸèˆ‡ MCP Server é€£æ¥ï¼Œä¸æœƒç­‰å¾…ä½¿ç”¨è€…å›æ‡‰"**

### âœ… è§£æ±ºæ–¹æ¡ˆ

**æ‚¨éœ€è¦çš„åŠŸèƒ½å·²ç¶“å®Œæ•´å¯¦ç¾äº†ï¼**MCP Client èª¿ç”¨å¾Œæœƒæ­£ç¢ºç­‰å¾…ç”¨æˆ¶æäº¤åé¥‹ã€‚

## ğŸ”§ å¯¦ç¾æ©Ÿåˆ¶

### 1. **Promise é˜»å¡æ©Ÿåˆ¶**

```typescript
// web-server.ts - å‰µå»º Promise ä¸¦ç­‰å¾…
return new Promise((resolve, reject) => {
  const session: SessionData = {
    resolve,  // â† ä¿å­˜ resolve å‡½æ•¸
    reject,
    workSummary,
    // ...
  };
  
  // åªæœ‰ç”¨æˆ¶æäº¤å¾Œæ‰èª¿ç”¨ resolve()
});
```

### 2. **MCP é€²åº¦é€šçŸ¥**

```typescript
// mcp-server.ts - ç™¼é€ç‹€æ…‹é€šçŸ¥
await this.sendLogNotification({
  level: 'info',
  logger: 'user-web-feedback',
  data: {
    message: 'â³ ç­‰å¾…ç”¨æˆ¶åé¥‹ä¸­...',
    status: 'waiting_for_user_input',
    timeout_seconds: 300
  }
});
```

### 3. **å·¥ä½œæµç¨‹**

```
AI èª¿ç”¨ collect_feedback
         â†“
MCP Server æ¥æ”¶è«‹æ±‚
         â†“
å‰µå»º Promiseï¼ˆpending ç‹€æ…‹ï¼‰
         â†“
ç™¼é€é€²åº¦é€šçŸ¥ï¼š"â³ ç­‰å¾…ç”¨æˆ¶åé¥‹ä¸­..."
         â†“
æ‰“é–‹ç€è¦½å™¨åé¥‹é é¢
         â†“
ã€ç­‰å¾…ä¸­...ã€‘â† Promise ä¿æŒ pending
         â†“
ç”¨æˆ¶æäº¤åé¥‹
         â†“
èª¿ç”¨ session.resolve(feedback)
         â†“
Promise å®Œæˆï¼Œè¿”å›çµæœçµ¦ AI
```

## ğŸ¯ ç‚ºä»€éº¼ MCP Client çŸ¥é“å·¥å…·é‚„åœ¨åŸ·è¡Œï¼Ÿ

### MCP å”è­°ç‰¹æ€§

1. **é•·æ™‚é–“é‹è¡Œå·¥å…·æ”¯æ´** - MCP å”è­°è¨­è¨ˆæ”¯æ´å¯é•·æ™‚é–“é‹è¡Œçš„å·¥å…·
2. **ç•°æ­¥ Promise** - å·¥å…·è¿”å› Promiseï¼Œåœ¨ resolve å‰ä¸€ç›´è™•æ–¼åŸ·è¡Œç‹€æ…‹
3. **é€²åº¦é€šçŸ¥** - é€šé `notifications/message` ç™¼é€ç‹€æ…‹æ›´æ–°
4. **è¶…æ™‚æ©Ÿåˆ¶** - è¨­ç½®åˆç†çš„è¶…æ™‚æ™‚é–“ï¼ˆé»˜èª 300 ç§’ = 5 åˆ†é˜ï¼‰

### æ—¥èªŒè¼¸å‡ºç¤ºä¾‹

ç•¶å·¥å…·é‹è¡Œæ™‚ï¼Œæ‚¨æœƒçœ‹åˆ°ï¼š

```
[INFO] ğŸ”„ MCP Server é–‹å§‹ç­‰å¾…ç”¨æˆ¶åé¥‹... (è¶…æ™‚: 300ç§’)
[INFO] ğŸ“Œ æ³¨æ„: collect_feedback èª¿ç”¨æœƒé˜»å¡ç›´åˆ°ç”¨æˆ¶æäº¤åé¥‹æˆ–è¶…æ™‚
[INFO] â³ ç­‰å¾…ç”¨æˆ¶åé¥‹ä¸­... (status: waiting_for_user_input)

[ç­‰å¾…ä¸­...]

[INFO] âœ… å–®æ¬¡æ¨¡å¼æœƒè©± xxx: ç”¨æˆ¶å·²æäº¤åé¥‹ï¼Œæº–å‚™ resolve Promise
[INFO] ğŸ¯ èª¿ç”¨ session.resolve()ï¼ŒMCP Client å°‡æ”¶åˆ°çµæœä¸¦ç¹¼çºŒåŸ·è¡Œ
[INFO] âœ… åé¥‹æ”¶é›†å®Œæˆï¼Œæ”¶åˆ° 1 æ¡åé¥‹
```

## âš™ï¸ é…ç½®å»ºè­°

### è¶…æ™‚è¨­ç½®

åœ¨ `.env` æˆ–ç’°å¢ƒè®Šæ•¸ä¸­è¨­ç½®ï¼š

```bash
# æ¨è–¦é…ç½®ï¼ˆ5åˆ†é˜ï¼‰- çµ¦ç”¨æˆ¶è¶³å¤ æ™‚é–“è¼¸å…¥
MCP_DIALOG_TIMEOUT="300"

# å¿«é€Ÿæ¸¬è©¦ï¼ˆ30ç§’ï¼‰
MCP_DIALOG_TIMEOUT="30"

# è¤‡é›œåé¥‹ï¼ˆ10åˆ†é˜ï¼‰
MCP_DIALOG_TIMEOUT="600"
```

### Claude Desktop é…ç½®

```json
{
  "mcpServers": {
    "user-web-feedback": {
      "command": "npx",
      "args": ["-y", "user-web-feedback@latest"],
      "env": {
        "MCP_DIALOG_TIMEOUT": "300"
      }
    }
  }
}
```

## ğŸ§ª æ¸¬è©¦æ–¹æ³•

### 1. å•Ÿå‹•æœå‹™å™¨ä¸¦æŸ¥çœ‹æ—¥èªŒ

```bash
# Windows
set MCP_DIALOG_TIMEOUT=300
npx user-web-feedback

# Linux/Mac
export MCP_DIALOG_TIMEOUT=300
npx user-web-feedback
```

### 2. åœ¨ Claude Desktop ä¸­æ¸¬è©¦

```
ä½ : è«‹ä½¿ç”¨ collect_feedback å·¥å…·æ”¶é›†æˆ‘çš„åé¥‹

Claude: 
[èª¿ç”¨å·¥å…·...]
â³ ç­‰å¾…ç”¨æˆ¶åé¥‹ä¸­...

[ç€è¦½å™¨è‡ªå‹•æ‰“é–‹]
[æ‚¨åœ¨ç€è¦½å™¨ä¸­è¼¸å…¥åé¥‹ä¸¦æäº¤]

Claude: 
âœ… æ”¶åˆ°æ‚¨çš„åé¥‹: "é€™æ˜¯æˆ‘çš„åé¥‹å…§å®¹"
[ç¹¼çºŒè™•ç†...]
```

### 3. è§€å¯Ÿæ—¥èªŒè¼¸å‡º

åœ¨æœå‹™å™¨æ—¥èªŒä¸­ï¼Œæ‚¨æ‡‰è©²çœ‹åˆ°ï¼š

1. âœ… å·¥å…·é–‹å§‹åŸ·è¡Œçš„é€šçŸ¥
2. â³ ç­‰å¾…ç”¨æˆ¶è¼¸å…¥çš„ç‹€æ…‹
3. ğŸ¯ resolve Promise çš„å‹•ä½œ
4. âœ… å®Œæˆä¸¦è¿”å›çµæœ

## ğŸ” å¸¸è¦‹å•é¡Œæ’æŸ¥

### Q1: "MCP Client é‚„æ˜¯ç«‹å³æ–·é–‹äº†"

**å¯èƒ½åŸå› **:
- è¶…æ™‚è¨­ç½®å¤ªçŸ­ï¼ˆé»˜èª 60 ç§’æ”¹ç‚º 300 ç§’ï¼‰
- MCP Client è‡ªèº«æœ‰è¶…æ™‚é™åˆ¶
- ç€è¦½å™¨æœªæˆåŠŸæ‰“é–‹

**è§£æ±ºæ–¹æ³•**:
```bash
# å¢åŠ è¶…æ™‚æ™‚é–“åˆ° 5 åˆ†é˜
MCP_DIALOG_TIMEOUT="300"
```

### Q2: "çœ‹ä¸åˆ°é€²åº¦é€šçŸ¥"

**æª¢æŸ¥**:
- Claude Desktop æ—¥èªŒç´šåˆ¥è¨­ç½®
- MCP Server æ—¥èªŒè¼¸å‡º

**å•Ÿç”¨è©³ç´°æ—¥èªŒ**:
```json
{
  "env": {
    "MCP_LOG_LEVEL": "debug",
    "MCP_DIALOG_TIMEOUT": "300"
  }
}
```

### Q3: "Promise æ²’æœ‰ resolve"

**æª¢æŸ¥é»**:
1. ç”¨æˆ¶æ˜¯å¦çœŸçš„æäº¤äº†åé¥‹ï¼ˆé»æ“Šã€Œæäº¤å›æ‡‰ã€æŒ‰éˆ•ï¼‰
2. WebSocket é€£æ¥æ˜¯å¦æ­£å¸¸
3. æŸ¥çœ‹æœå‹™å™¨æ—¥èªŒä¸­æ˜¯å¦æœ‰ `session.resolve()` èª¿ç”¨

## ğŸ“Š é€²åº¦é€šçŸ¥æ©Ÿåˆ¶

### MCP æ—¥èªŒé€šçŸ¥æ ¼å¼

```json
{
  "method": "notifications/message",
  "params": {
    "level": "info",
    "logger": "user-web-feedback",
    "data": {
      "message": "â³ ç­‰å¾…ç”¨æˆ¶åé¥‹ä¸­...",
      "status": "waiting_for_user_input",
      "timeout_seconds": 300,
      "web_interface": "Browser window opened"
    }
  }
}
```

### ç‹€æ…‹æ›´æ–°åºåˆ—

1. **é–‹å§‹**: `status: "waiting_for_user_input"`
2. **æ”¶åˆ°åé¥‹**: `status: "feedback_received"`
3. **å®Œæˆ**: å·¥å…·è¿”å›çµæœ

## âœ… çµè«–

**æ‚¨éœ€è¦çš„åŠŸèƒ½å·²ç¶“å®Œå…¨å¯¦ç¾ï¼**

- âœ… MCP Client æœƒç­‰å¾…ç”¨æˆ¶æäº¤åé¥‹
- âœ… ä½¿ç”¨ Promise æ©Ÿåˆ¶ä¿æŒå·¥å…·åŸ·è¡Œç‹€æ…‹
- âœ… ç™¼é€é€²åº¦é€šçŸ¥å‘ŠçŸ¥ Client å·¥å…·ä»åœ¨é‹è¡Œ
- âœ… æ”¯æ´é•·é” 300 ç§’ï¼ˆ5åˆ†é˜ï¼‰çš„ç­‰å¾…æ™‚é–“
- âœ… ç”¨æˆ¶æäº¤å¾Œæ‰è¿”å›çµæœçµ¦ AI

å¦‚æœä»æœ‰å•é¡Œï¼Œè«‹ï¼š
1. è¨­ç½® `MCP_DIALOG_TIMEOUT="300"` å¢åŠ è¶…æ™‚æ™‚é–“
2. å•Ÿç”¨ `MCP_LOG_LEVEL="debug"` æŸ¥çœ‹è©³ç´°æ—¥èªŒ
3. åˆ†äº«æ—¥èªŒè¼¸å‡ºä»¥ä¾¿é€²ä¸€æ­¥è¨ºæ–·

---

**æ¸¬è©¦æ™‚é–“**: 2025-10-26  
**ç‰ˆæœ¬**: v2.2.0  
**ç‹€æ…‹**: âœ… åŠŸèƒ½æ­£å¸¸é‹ä½œ
