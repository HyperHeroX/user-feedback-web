<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>âš™ï¸ ç³»çµ±è¨­å®š - User Feedback</title>
    <link rel="icon" type="image/svg+xml" href="favicon.svg">
    <script src="/socket.io.min.js"></script>
    <!-- Navbar Component -->
    <link rel="stylesheet" href="/components/navbar.css">
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="dashboard.css">
    <style>
        .settings-container {
            max-width: 900px;
            margin: 20px auto;
            padding: 0 20px 40px 20px;
            height: calc(100vh - 60px);
            overflow-y: auto;
        }

        .page-header {
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--border-color);
        }

        .page-title {
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 1.75rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .settings-section {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-md);
            padding: 24px;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            font-size: 14px;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 8px;
        }

        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            font-size: 14px;
            background: var(--bg-primary);
            color: var(--text-primary);
            transition: border-color 0.2s ease;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--accent-blue);
        }

        .form-textarea {
            min-height: 120px;
            resize: vertical;
            font-family: 'Courier New', monospace;
        }

        .form-help {
            font-size: 12px;
            color: var(--text-muted);
            margin-top: 4px;
        }

        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            margin-top: 24px;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        .checkbox-group label {
            font-size: 14px;
            color: var(--text-primary);
            cursor: pointer;
        }

        .masked-input {
            position: relative;
        }

        .masked-input input {
            padding-right: 40px;
        }

        .toggle-mask-btn {
            position: absolute;
            right: 8px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            cursor: pointer;
            font-size: 18px;
            padding: 4px;
        }

        .save-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 12px;
            border-radius: 4px;
            font-size: 13px;
            font-weight: 500;
            margin-left: auto;
        }

        .save-indicator.success {
            background: rgba(34, 197, 94, 0.1);
            color: #22c55e;
        }

        .save-indicator.error {
            background: rgba(239, 68, 68, 0.1);
            color: #ef4444;
        }

        /* Prompt Config Styles */
        .prompt-config-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
            margin-bottom: 16px;
        }

        .prompt-config-item {
            background: var(--bg-secondary);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            padding: 16px;
        }

        .prompt-config-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 12px;
            margin-bottom: 12px;
        }

        .prompt-config-name {
            font-weight: 600;
            color: var(--text-primary);
            font-size: 14px;
        }

        .prompt-config-controls {
            display: flex;
            align-items: center;
            gap: 16px;
            flex-wrap: wrap;
        }

        .prompt-config-controls label {
            display: flex;
            align-items: center;
            gap: 6px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .prompt-config-controls input[type="number"] {
            width: 60px;
            padding: 4px 8px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            font-size: 13px;
            background: var(--bg-primary);
            color: var(--text-primary);
        }

        .prompt-config-controls input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .prompt-config-content {
            margin-top: 12px;
        }

        .prompt-config-content textarea {
            width: 100%;
            min-height: 80px;
            padding: 10px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            font-size: 13px;
            font-family: 'Courier New', monospace;
            background: var(--bg-primary);
            color: var(--text-primary);
            resize: vertical;
        }

        .prompt-config-content.collapsed {
            display: none;
        }

        .toggle-content-btn {
            background: none;
            border: none;
            color: var(--accent-blue);
            cursor: pointer;
            font-size: 12px;
            padding: 4px 8px;
        }

        .toggle-content-btn:hover {
            text-decoration: underline;
        }

        /* Provider Tabs */
        .provider-tabs {
            display: flex;
            gap: 8px;
        }

        .provider-tab {
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            background: var(--bg-secondary);
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 13px;
            transition: all 0.2s ease;
        }

        .provider-tab:hover {
            border-color: var(--accent-blue);
        }

        .provider-tab.active {
            background: var(--accent-blue);
            border-color: var(--accent-blue);
            color: white;
        }

        .provider-settings {
            margin-top: 16px;
        }

        .loading-state {
            text-align: center;
            padding: 20px;
            color: var(--text-muted);
        }
    </style>
</head>
<body>
    <!-- Unified Navigation Bar (injected by navbar.js) -->
    
    <div class="settings-container">
        <header class="page-header">
            <h1 class="page-title">
                <span class="icon">âš™ï¸</span>
                ç³»çµ±è¨­å®š
            </h1>
        </header>

        <!-- AI è¨­å®š -->
        <section class="settings-section">
            <h2 class="section-title">
                <span class="icon">ğŸ¤–</span>
                AI è¨­å®š
            </h2>
            
            <div class="form-group">
                <label class="form-label" for="aiProvider">AI æä¾›å•†</label>
                <select id="aiProvider" class="form-select">
                    <option value="openai">OpenAI</option>
                    <option value="anthropic">Anthropic (Claude)</option>
                    <option value="google">Google (Gemini)</option>
                </select>
            </div>

            <div class="form-group">
                <label class="form-label" for="apiKey">API é‡‘é‘°</label>
                <div class="masked-input">
                    <input type="password" id="apiKey" class="form-input" placeholder="è¼¸å…¥æ‚¨çš„ API é‡‘é‘°">
                    <button type="button" class="toggle-mask-btn" id="toggleApiKey">ğŸ‘ï¸</button>
                </div>
                <p class="form-help">API é‡‘é‘°å°‡è¢«åŠ å¯†å„²å­˜</p>
            </div>

            <div class="form-group">
                <label class="form-label" for="aiModel">æ¨¡å‹</label>
                <input type="text" id="aiModel" class="form-input" placeholder="ä¾‹å¦‚: gpt-4-turbo, claude-3-opus">
            </div>

            <div class="form-group">
                <label class="form-label" for="systemPrompt">ç³»çµ±æç¤ºè©</label>
                <textarea id="systemPrompt" class="form-textarea" placeholder="è‡ªå®šç¾©ç³»çµ±æç¤ºè©..."></textarea>
                <p class="form-help">ç•™ç©ºå°‡ä½¿ç”¨é è¨­æç¤ºè©</p>
            </div>

            <div class="form-group">
                <label class="form-label" for="mcpToolsPrompt">MCP å·¥å…·æç¤ºè©</label>
                <textarea id="mcpToolsPrompt" class="form-textarea" placeholder="è¨­å®š MCP å·¥å…·çš„ä½¿ç”¨èªªæ˜..."></textarea>
                <p class="form-help">å®šç¾© AI å¦‚ä½•ä½¿ç”¨ MCP å·¥å…·ã€‚{project_name} å’Œ {project_path} æœƒè¢«æ›¿æ›ç‚ºå¯¦éš›å€¼</p>
            </div>

            <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                <div class="form-group">
                    <label class="form-label" for="temperature">Temperature</label>
                    <input type="number" id="temperature" class="form-input" min="0" max="2" step="0.1" value="0.7">
                </div>
                <div class="form-group">
                    <label class="form-label" for="maxTokens">Max Tokens</label>
                    <input type="number" id="maxTokens" class="form-input" min="100" max="4000" step="100" value="1000">
                </div>
            </div>

            <div class="form-row" style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
                <div class="form-group">
                    <label class="form-label" for="autoReplyTimerSeconds">è‡ªå‹•å›è¦†æ™‚é–“ï¼ˆç§’ï¼‰</label>
                    <input type="number" id="autoReplyTimerSeconds" class="form-input" min="30" max="600" step="10" value="300">
                    <p class="form-help">30-600 ç§’ï¼Œé è¨­ 300 ç§’</p>
                </div>
                <div class="form-group">
                    <label class="form-label" for="maxToolRounds">AI äº¤è«‡æ¬¡æ•¸ä¸Šé™</label>
                    <input type="number" id="maxToolRounds" class="form-input" min="1" max="20" step="1" value="5">
                    <p class="form-help">1-20 æ¬¡ï¼Œé è¨­ 5 æ¬¡</p>
                </div>
            </div>

            <div class="form-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="debugMode" />
                    <label for="debugMode">ğŸ”§ Debug æ¨¡å¼</label>
                </div>
                <p class="form-help">é–‹å•Ÿå¾Œ Streaming Panel ä¸æœƒè‡ªå‹•é—œé–‰</p>
            </div>

            <div class="form-actions">
                <button id="testAiBtn" class="btn btn-secondary">æ¸¬è©¦é€£æ¥</button>
                <button id="saveAiBtn" class="btn btn-primary">å„²å­˜ AI è¨­å®š</button>
            </div>
        </section>

        <!-- CLI æ¨¡å¼è¨­å®š -->
        <section class="settings-section">
            <h2 class="section-title">
                <span class="icon">ğŸ’»</span>
                CLI æ¨¡å¼è¨­å®š
            </h2>
            
            <div class="form-group">
                <label class="form-label">AI å›æ‡‰æ¨¡å¼</label>
                <div class="radio-group" style="display: flex; gap: 20px; margin-top: 8px;">
                    <label class="radio-label" style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="radio" name="aiMode" value="api" id="aiModeApi" checked>
                        <span>ğŸ”Œ API æ¨¡å¼</span>
                    </label>
                    <label class="radio-label" style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                        <input type="radio" name="aiMode" value="cli" id="aiModeCli">
                        <span>ğŸ’» CLI æ¨¡å¼</span>
                    </label>
                </div>
                <p class="form-help">API æ¨¡å¼ä½¿ç”¨ Google Gemini APIï¼ŒCLI æ¨¡å¼ä½¿ç”¨æœ¬æ©Ÿå®‰è£çš„ CLI å·¥å…·</p>
            </div>

            <div class="form-group" id="cliToolGroup" style="display: none;">
                <label class="form-label" for="cliTool">CLI å·¥å…·</label>
                <select id="cliTool" class="form-select">
                    <option value="gemini">Gemini CLI</option>
                    <option value="claude">Claude CLI</option>
                </select>
                <p class="form-help" id="cliToolStatus">æ­£åœ¨æª¢æ¸¬å·²å®‰è£çš„ CLI å·¥å…·...</p>
            </div>

            <div class="form-group" id="cliTimeoutGroup" style="display: none;">
                <label class="form-label" for="cliTimeout">CLI åŸ·è¡Œè¶…æ™‚ï¼ˆç§’ï¼‰</label>
                <input type="number" id="cliTimeout" class="form-input" min="30" max="600" step="10" value="120">
                <p class="form-help">30-600 ç§’ï¼Œé è¨­ 120 ç§’</p>
            </div>

            <div class="form-group" id="cliFallbackGroup" style="display: none;">
                <div class="checkbox-group">
                    <input type="checkbox" id="cliFallbackToApi" checked />
                    <label for="cliFallbackToApi">CLI å¤±æ•—æ™‚è‡ªå‹•åˆ‡æ›åˆ° API æ¨¡å¼</label>
                </div>
                <p class="form-help">å•Ÿç”¨å¾Œï¼Œç•¶ CLI åŸ·è¡Œå¤±æ•—æ™‚æœƒè‡ªå‹•ä½¿ç”¨ API æ¨¡å¼</p>
            </div>

            <div class="form-actions">
                <button id="detectCliBtn" class="btn btn-secondary">ğŸ” é‡æ–°æª¢æ¸¬ CLI å·¥å…·</button>
                <button id="saveCliBtn" class="btn btn-primary">å„²å­˜ CLI è¨­å®š</button>
            </div>
        </section>

        <!-- ç”¨æˆ¶åå¥½ -->
        <section class="settings-section">
            <h2 class="section-title">
                <span class="icon">ğŸ‘¤</span>
                ç”¨æˆ¶åå¥½
            </h2>

            <div class="form-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="autoSubmitOnTimeout" />
                    <label for="autoSubmitOnTimeout">æœƒè©±è¶…æ™‚æ™‚è‡ªå‹•æäº¤</label>
                </div>
                <p class="form-help">å•Ÿç”¨å¾Œï¼Œç•¶å°è©±é€¾æ™‚æ™‚å°‡è‡ªå‹•æäº¤ç©ºç™½å›æ‡‰</p>
            </div>

            <div class="form-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="confirmBeforeSubmit" />
                    <label for="confirmBeforeSubmit">æäº¤å‰ç¢ºèª</label>
                </div>
                <p class="form-help">å•Ÿç”¨å¾Œï¼Œæäº¤å›æ‡‰å‰æœƒé¡¯ç¤ºç¢ºèªå°è©±æ¡†</p>
            </div>

            <div class="form-group">
                <label class="form-label" for="defaultLanguage">é è¨­èªè¨€</label>
                <select id="defaultLanguage" class="form-select">
                    <option value="zh-TW">ç¹é«”ä¸­æ–‡</option>
                    <option value="zh-CN">ç®€ä½“ä¸­æ–‡</option>
                    <option value="en">English</option>
                    <option value="ja">æ—¥æœ¬èª</option>
                </select>
            </div>

            <div class="form-actions">
                <button id="savePreferencesBtn" class="btn btn-primary">å„²å­˜åå¥½è¨­å®š</button>
            </div>
        </section>

        <!-- Self-Probe è¨­å®š -->
        <section class="settings-section">
            <h2 class="section-title">
                <span class="icon">ğŸ’“</span>
                è‡ªæˆ‘æ¢æŸ¥ (Keep-Alive)
            </h2>
            
            <div class="form-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="enableSelfProbe" />
                    <label for="enableSelfProbe">å•Ÿç”¨è‡ªæˆ‘æ¢æŸ¥</label>
                </div>
                <p class="form-help">å®šæœŸæª¢æŸ¥æœå‹™ç‹€æ…‹ï¼Œé˜²æ­¢å› é–’ç½®è¢«ç³»çµ±å›æ”¶</p>
            </div>

            <div class="form-group" id="selfProbeIntervalGroup">
                <label class="form-label" for="selfProbeInterval">æ¢æŸ¥é–“éš”ï¼ˆç§’ï¼‰</label>
                <input type="number" id="selfProbeInterval" class="form-input" 
                       min="60" max="600" step="30" value="300">
                <p class="form-help">60-600 ç§’ï¼Œé è¨­ 300 ç§’ï¼ˆ5 åˆ†é˜ï¼‰</p>
            </div>

            <div class="form-group" id="selfProbeStatus" style="display: none;">
                <label class="form-label">ç‹€æ…‹è³‡è¨Š</label>
                <div class="status-info" style="font-size: 13px; color: var(--text-muted); padding: 8px; background: var(--bg-secondary); border-radius: var(--radius-sm);">
                    <div id="selfProbeRunning">åŸ·è¡Œç‹€æ…‹: --</div>
                    <div id="selfProbeCount">æ¢æŸ¥æ¬¡æ•¸: --</div>
                    <div id="selfProbeLastTime">ä¸Šæ¬¡æ¢æŸ¥: --</div>
                </div>
            </div>

            <div class="form-actions">
                <button id="saveSelfProbeBtn" class="btn btn-primary">å„²å­˜è¨­å®š</button>
            </div>
        </section>

        <!-- æç¤ºè©è¨­å®š -->
        <section class="settings-section">
            <h2 class="section-title">
                <span class="icon">ğŸ“</span>
                AI æç¤ºè©è¨­å®š
            </h2>
            <p class="form-help" style="margin-bottom: 16px;">
                è‡ªå®šç¾© AI å›è¦†æ™‚ä½¿ç”¨çš„æç¤ºè©é †åºã€‚ç¬¬ä¸€æ¬¡é †åºç”¨æ–¼é¦–æ¬¡ AI å‘¼å«ï¼Œç¬¬äºŒæ¬¡é †åºç”¨æ–¼å¾ŒçºŒå‘¼å«ã€‚
                é †åºç‚º 0 è¡¨ç¤ºä¸ä½¿ç”¨è©²çµ„ä»¶ã€‚
            </p>
            
            <div id="promptConfigList" class="prompt-config-list">
                <div class="loading-state">æ­£åœ¨è¼‰å…¥æç¤ºè©é…ç½®...</div>
            </div>

            <div class="form-actions">
                <button id="resetPromptsBtn" class="btn btn-secondary">æ¢å¾©é è¨­</button>
                <button id="savePromptsBtn" class="btn btn-primary">å„²å­˜æç¤ºè©è¨­å®š</button>
            </div>
        </section>

        <!-- API æä¾›å•†è¨­å®š -->
        <section class="settings-section">
            <h2 class="section-title">
                <span class="icon">ğŸ”Œ</span>
                æ“´å±• API æä¾›å•†
            </h2>
            <p class="form-help" style="margin-bottom: 16px;">
                é…ç½®é¡å¤–çš„ AI API æä¾›å•†ï¼ˆNVIDIAã€Z.AI ç­‰ï¼‰ã€‚é€™äº›è¨­å®šèˆ‡ä¸»è¦ AI è¨­å®šåˆ†é–‹ç®¡ç†ã€‚
            </p>
            
            <div class="form-group">
                <label class="form-label">é¸æ“‡æä¾›å•†</label>
                <div class="provider-tabs" style="display: flex; gap: 8px; margin-bottom: 16px;">
                    <button class="provider-tab active" data-provider="nvidia">NVIDIA</button>
                    <button class="provider-tab" data-provider="zai">Z.AI (Zhipu AI)</button>
                </div>
            </div>

            <!-- NVIDIA è¨­å®š -->
            <div id="nvidiaSettings" class="provider-settings">
                <div class="form-group">
                    <label class="form-label" for="nvidiaEndpoint">API Endpoint</label>
                    <input type="url" id="nvidiaEndpoint" class="form-input" 
                           value="https://integrate.api.nvidia.com/v1" readonly>
                    <p class="form-help">/chat/completions å¾Œç¶´æœƒè‡ªå‹•æ·»åŠ </p>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="nvidiaApiKey">API Key</label>
                    <input type="password" id="nvidiaApiKey" class="form-input" 
                           placeholder="è¼¸å…¥ NVIDIA API Key">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="nvidiaModel">Model ID</label>
                    <input type="text" id="nvidiaModel" class="form-input" 
                           placeholder="nvidia/llama-3.1-nemotron-70b-instruct">
                    <p class="form-help">ä¾‹å¦‚: nvidia/llama-3.1-nemotron-70b-instruct</p>
                </div>

                <div class="form-actions">
                    <button id="testNvidiaBtn" class="btn btn-secondary">æ¸¬è©¦é€£æ¥</button>
                    <button id="saveNvidiaBtn" class="btn btn-primary">å„²å­˜ NVIDIA è¨­å®š</button>
                </div>
            </div>

            <!-- Z.AI è¨­å®š -->
            <div id="zaiSettings" class="provider-settings" style="display: none;">
                <div class="form-group">
                    <label class="form-label" for="zaiRegion">åœ°å€</label>
                    <select id="zaiRegion" class="form-select">
                        <option value="international">åœ‹éš›ç‰ˆ (api.z.ai)</option>
                        <option value="china">ä¸­åœ‹ç‰ˆ (bigmodel.cn)</option>
                    </select>
                    <p class="form-help">é¸æ“‡æ‚¨çš„æœå‹™å€åŸŸ</p>
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="zaiApiKey">API Key</label>
                    <input type="password" id="zaiApiKey" class="form-input" 
                           placeholder="è¼¸å…¥ Z.AI API Key">
                </div>
                
                <div class="form-group">
                    <label class="form-label" for="zaiModel">Model ID</label>
                    <input type="text" id="zaiModel" class="form-input" 
                           placeholder="glm-4">
                    <p class="form-help">ä¾‹å¦‚: glm-4, glm-4-plus, glm-4-flash</p>
                </div>

                <div class="form-actions">
                    <button id="testZaiBtn" class="btn btn-secondary">æ¸¬è©¦é€£æ¥</button>
                    <button id="saveZaiBtn" class="btn btn-primary">å„²å­˜ Z.AI è¨­å®š</button>
                </div>
            </div>
        </section>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer" class="toast-container"></div>

    <!-- Scripts -->
    <script src="/components/navbar.js"></script>
    <script src="settings.js"></script>
</body>
</html>

